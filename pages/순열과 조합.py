import streamlit as st
import math

# --- í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ---
st.set_page_config(
    page_title="ìˆœì—´/ì¡°í•© ê³¼ì • ê³„ì‚°ê¸°",
    page_icon="ğŸ§®",
    layout="wide"
)

# --- ì œëª© ---
st.title("ğŸ§® ìˆœì—´/ì¡°í•© ê³¼ì • ê³„ì‚°ê¸°")
st.markdown("ìˆ«ì nê³¼ rì„ ì…ë ¥í•˜ë©´, ê³„ì‚° ê³¼ì •ê³¼ ê²°ê³¼ë¥¼ ë‹¨ê³„ë³„ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.")

# --- íŒ©í† ë¦¬ì–¼ ê³„ì‚° ë° ê³¼ì • ë¬¸ìì—´ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ ---
def factorial_with_steps(k):
    """íŒ©í† ë¦¬ì–¼ ê°’ì„ ê³„ì‚°í•˜ê³ , ê³„ì‚° ê³¼ì •ì„ ë¬¸ìì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤."""
    if k == 0:
        return 1, "1 (0!ì€ 1ë¡œ ì •ì˜ë©ë‹ˆë‹¤)"
    
    # ê³„ì‚° ê³¼ì • ë¬¸ìì—´ ìƒì„± (ì˜ˆ: 5 Ã— 4 Ã— 3 Ã— 2 Ã— 1)
    steps_str = " Ã— ".join(map(str, range(k, 0, -1)))
    
    # ì‹¤ì œ íŒ©í† ë¦¬ì–¼ ê°’ ê³„ì‚°
    result = math.factorial(k)
    
    return result, steps_str

# --- ì‚¬ìš©ì ì…ë ¥ (2ê°œì˜ ì»¬ëŸ¼ ì‚¬ìš©) ---
col1_input, col2_input = st.columns(2)
with col1_input:
    n = st.number_input("ì „ì²´ ê°œìˆ˜ (n)ì„ ì…ë ¥í•˜ì„¸ìš”", min_value=0, value=5, step=1)
with col2_input:
    # rì€ në³´ë‹¤ í´ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ max_value=nìœ¼ë¡œ ì„¤ì •
    r = st.number_input("ë½‘ì„ ê°œìˆ˜ (r)ì„ ì…ë ¥í•˜ì„¸ìš”", min_value=0, max_value=n, value=3, step=1)

# --- ê³„ì‚° ë° ê²°ê³¼ í‘œì‹œ ---
if st.button("ê²°ê³¼ ê³„ì‚°í•˜ê¸°"):
    col1_result, col2_result = st.columns(2)

    # --- ìˆœì—´ (Permutation) ---
    with col1_result:
        st.subheader(f"ğŸ¥‡ ìˆœì—´: {n}P{r} ê³„ì‚° ê³¼ì •")

        # ê³µì‹ ë³´ì—¬ì£¼ê¸°
        st.latex(fr"nPr = \frac{{n!}}{{(n-r)!}} = \frac{{{n}!}}{{({n}-{r})!}} = \frac{{{n}!}}{{{n-r}!}}")
        
        with st.expander("ìì„¸í•œ ê³„ì‚° ê³¼ì • ë³´ê¸°"):
            # 1. ë¶„ì n! ê³„ì‚° ê³¼ì •
            n_fact_val, n_fact_steps = factorial_with_steps(n)
            st.markdown(f"**1. ë¶„ì `n!` ê³„ì‚°:**")
            st.markdown(f"`{n}!` = {n_fact_steps} = **`{n_fact_val}`**")

            # 2. ë¶„ëª¨ (n-r)! ê³„ì‚° ê³¼ì •
            n_minus_r = n - r
            nmr_fact_val, nmr_fact_steps = factorial_with_steps(n_minus_r)
            st.markdown(f"**2. ë¶„ëª¨ `(n-r)!` ê³„ì‚°:**")
            st.markdown(f"`({n}-{r})!` = `{n_minus_r}!` = {nmr_fact_steps} = **`{nmr_fact_val}`**")
            
            # 3. ìµœì¢… ê³„ì‚°
            st.markdown(f"**3. ìµœì¢… ê³„ì‚°:**")
            if nmr_fact_val == 0: # 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²½ìš° ë°©ì§€
                st.error("ì˜¤ë¥˜: 0ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
                p_result = "ê³„ì‚° ë¶ˆê°€"
            else:
                p_result = n_fact_val // nmr_fact_val
                st.latex(fr"\frac{{{n_fact_val}}}{{{nmr_fact_val}}} = {p_result}")

        # ìµœì¢… ê²°ê³¼
        st.success(f"**ê²°ê³¼: {n}P{r} = {p_result}**")

    # --- ì¡°í•© (Combination) ---
    with col2_result:
        st.subheader(f"ğŸ¤ ì¡°í•©: {n}C{r} ê³„ì‚° ê³¼ì •")

        # ê³µì‹ ë³´ì—¬ì£¼ê¸°
        st.latex(fr"nCr = \frac{{n!}}{{r!(n-r)!}} = \frac{{{n}!}}{{{r}!({n}-{r})!}} = \frac{{{n}!}}{{{r}!{n-r}!}}")

        with st.expander("ìì„¸í•œ ê³„ì‚° ê³¼ì • ë³´ê¸°"):
            # 1. ë¶„ì n! ê³„ì‚° ê³¼ì • (ìˆœì—´ì—ì„œ ì´ë¯¸ ê³„ì‚°í–ˆì§€ë§Œ, êµìœ¡ìš©ìœ¼ë¡œ ë‹¤ì‹œ ë³´ì—¬ì¤Œ)
            n_fact_val, n_fact_steps = factorial_with_steps(n)
            st.markdown(f"**1. ë¶„ì `n!` ê³„ì‚°:**")
            st.markdown(f"`{n}!` = {n_fact_steps} = **`{n_fact_val}`**")

            # 2. ë¶„ëª¨ r! ê³„ì‚° ê³¼ì •
            r_fact_val, r_fact_steps = factorial_with_steps(r)
            st.markdown(f"**2. ë¶„ëª¨ `r!` ê³„ì‚°:**")
            st.markdown(f"`{r}!` = {r_fact_steps} = **`{r_fact_val}`**")
            
            # 3. ë¶„ëª¨ (n-r)! ê³„ì‚° ê³¼ì •
            n_minus_r = n - r
            nmr_fact_val, nmr_fact_steps = factorial_with_steps(n_minus_r)
            st.markdown(f"**3. ë¶„ëª¨ `(n-r)!` ê³„ì‚°:**")
            st.markdown(f"`({n}-{r})!` = `{n_minus_r}!` = {nmr_fact_steps} = **`{nmr_fact_val}`**")
            
            # 4. ìµœì¢… ê³„ì‚°
            st.markdown(f"**4. ìµœì¢… ê³„ì‚°:**")
            denominator = r_fact_val * nmr_fact_val
            if denominator == 0:
                st.error("ì˜¤ë¥˜: 0ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
                c_result = "ê³„ì‚° ë¶ˆê°€"
            else:
                c_result = n_fact_val // denominator
                st.latex(fr"\frac{{{n_fact_val}}}{{{r_fact_val} \times {nmr_fact_val}}} = \frac{{{n_fact_val}}}{{{denominator}}} = {c_result}")
        
        # ìµœì¢… ê²°ê³¼
        st.success(f"**ê²°ê³¼: {n}C{r} = {c_result}**")

else:
    st.info("ìœ„ ìƒìì— ìˆ«ì nê³¼ rì„ ì…ë ¥í•˜ê³  'ê²°ê³¼ ê³„ì‚°í•˜ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.")

    import streamlit as st

# --- í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ---
st.set_page_config(
    page_title="ìˆœì—´ê³¼ ì¡°í•© ì‹¬í™” í•™ìŠµ",
    page_icon="ğŸ¤”",
    layout="wide"
)

# --- 1. ë©”ì¸ íƒ€ì´í‹€ ë° ë„ì… ì§ˆë¬¸ ---
st.title("ğŸ¤” ìˆœì—´ê³¼ ì¡°í•©, ì–¸ì œ ì–´ë–»ê²Œ ë‹¤ë¥¼ê¹Œ?")
st.markdown("---")
st.info("""
**"4ëª… ì¤‘ì— 2ëª…ì„ ë½‘ëŠ”ë‹¤"**ëŠ” ë˜‘ê°™ì€ ìƒí™©ì¸ë°, ì™œ ì–´ë–¨ ë•ŒëŠ” **ìˆœì—´**ì„ ì“°ê³ , ì–´ë–¨ ë•ŒëŠ” **ì¡°í•©**ì„ ì“¸ê¹Œìš”?  
ë‘ ê°œë…ì˜ ê²°ì •ì ì¸ ì°¨ì´ëŠ” ë°”ë¡œ **'ìˆœì„œ' ë˜ëŠ” 'ìë¦¬'ì˜ ì¤‘ìš”ì„±**ì— ìˆìŠµë‹ˆë‹¤. ì´ í˜ì´ì§€ì—ì„œ ê·¸ ì°¨ì´ë¥¼ í™•ì‹¤í•˜ê²Œ ì•Œì•„ë´…ì‹œë‹¤!
""")

# --- 2. ê°œë… ë¹„êµ ---
st.header("ğŸ¥‡ ìˆœì—´ vs ğŸ¤ ì¡°í•©: í•µì‹¬ ê°œë… ë¹„êµ")

col1, col2 = st.columns(2)

with col1:
    st.subheader("ğŸ¥‡ ìˆœì—´ (Permutation)")
    st.markdown("""
    -   **ì •ì˜:** ì„œë¡œ ë‹¤ë¥¸ nê°œì—ì„œ **ìˆœì„œë¥¼ ìƒê°í•˜ë©°** rê°œë¥¼ ë½‘ì•„ ë‚˜ì—´í•˜ëŠ” ê²½ìš°ì˜ ìˆ˜.
    -   **í•µì‹¬:** ë½‘ì€ ë‹¤ìŒì— **'ìë¦¬'ë¥¼ ì§€ì •**í•˜ê±°ë‚˜ **'ì—­í• ì„ ë¶€ì—¬'**í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.
    -   **ê²°ê³¼:** `(A, B)`ì™€ `(B, A)`ëŠ” **ì„œë¡œ ë‹¤ë¥¸ ê²½ìš°**ë¡œ ì·¨ê¸‰ë©ë‹ˆë‹¤.
    -   **í‚¤ì›Œë“œ:** `ì¤„ ì„¸ìš°ê¸°`, `ë°°ì—´í•˜ê¸°`, `íšŒì¥/ë¶€íšŒì¥ ë½‘ê¸°`, `ì´ì–´ë‹¬ë¦¬ê¸° ìˆœì„œ ì •í•˜ê¸°`, `ë¹„ë°€ë²ˆí˜¸ ë§Œë“¤ê¸°`
    """)

with col2:
    st.subheader("ğŸ¤ ì¡°í•© (Combination)")
    st.markdown("""
    -   **ì •ì˜:** ì„œë¡œ ë‹¤ë¥¸ nê°œì—ì„œ **ìˆœì„œì— ìƒê´€ì—†ì´** rê°œë¥¼ ë½‘ëŠ” ê²½ìš°ì˜ ìˆ˜.
    -   **í•µì‹¬:** ê·¸ëƒ¥ **'ê·¸ë£¹'**ì´ë‚˜ **'íŒ€'ì„ êµ¬ì„±**í•˜ê¸°ë§Œ í•˜ë©´ ëì…ë‹ˆë‹¤.
    -   **ê²°ê³¼:** `{A, B}`ì™€ `{B, A}`ëŠ” **ì™„ì „íˆ ê°™ì€ ê²½ìš°**ë¡œ ì·¨ê¸‰ë©ë‹ˆë‹¤.
    -   **í‚¤ì›Œë“œ:** `ëŒ€í‘œ ë½‘ê¸°`, `ì„ ë°œí•˜ê¸°`, `ì²­ì†Œ ë‹¹ë²ˆ ë½‘ê¸°`, `íŒ€ êµ¬ì„±í•˜ê¸°`, `ê³¼ì¼ ë°”êµ¬ë‹ˆ ë§Œë“¤ê¸°`
    """)
st.markdown("---")

# --- 3. ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì´í•´í•˜ê¸° ---
st.header("ğŸ’¼ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë°°ìš°ëŠ” ìˆœì—´ê³¼ ì¡°í•©")
st.markdown("ë„¤ ëª…ì˜ ì¹œêµ¬ **A, B, C, D**ê°€ ìˆë‹¤ê³  ìƒìƒí•´ë´…ì‹œë‹¤. ì´ ì¤‘ì—ì„œ **2ëª…**ì„ ë½‘ëŠ” ìƒí™©ì…ë‹ˆë‹¤.")

# ì‹œë‚˜ë¦¬ì˜¤ 1: ìˆœì—´
st.subheader("ìƒí™© 1: ë°˜ì¥ê³¼ ë¶€ë°˜ì¥ì„ í•œ ëª…ì”© ë½‘ëŠ” ê²½ìš° (ìˆœì—´)")
st.write("""
ì´ ê²½ìš°ëŠ” **'ë°˜ì¥'**ì´ë¼ëŠ” ìë¦¬ì™€ **'ë¶€ë°˜ì¥'**ì´ë¼ëŠ” ìë¦¬ê°€ ì„œë¡œ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.
-   Aê°€ ë°˜ì¥, Bê°€ ë¶€ë°˜ì¥ì¸ ê²½ìš° `(A, B)`
-   Bê°€ ë°˜ì¥, Aê°€ ë¶€ë°˜ì¥ì¸ ê²½ìš° `(B, A)`

ì´ ë‘ ê°€ì§€ëŠ” ëª…ë°±íˆ **ë‹¤ë¥¸ ê²°ê³¼**ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë‚˜ì—´í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì´ **12ê°€ì§€**ê°€ ë‚˜ì˜µë‹ˆë‹¤.
""")
st.code("""
(A, B), (A, C), (A, D)
(B, A), (B, C), (B, D)
(C, A), (C, B), (C, D)
(D, A), (D, B), (D, C)
""")
st.success("ê³„ì‚°: **4P2** = 4 Ã— 3 = **12**")

# ì‹œë‚˜ë¦¬ì˜¤ 2: ì¡°í•©
st.subheader("ìƒí™© 2: êµì‹¤ ì²­ì†Œë¥¼ í•  ëŒ€í‘œ 2ëª…ì„ ë½‘ëŠ” ê²½ìš° (ì¡°í•©)")
st.write("""
ì´ ê²½ìš°ëŠ” ë‘ ëª… ëª¨ë‘ **'ëŒ€í‘œ'**ë¼ëŠ” ë™ë“±í•œ ìê²©ì´ë¯€ë¡œ ìˆœì„œê°€ ì¤‘ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
-   Aì™€ Bê°€ ëŒ€í‘œë¡œ ë½‘íŒ ê²½ìš° `{A, B}`
-   Bì™€ Aê°€ ëŒ€í‘œë¡œ ë½‘íŒ ê²½ìš° `{B, A}`

ì´ ë‘ ê°€ì§€ëŠ” ê²°êµ­ **'Aì™€ Bê°€ ì²­ì†Œí•œë‹¤'**ëŠ” ë™ì¼í•œ ê²°ê³¼ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ìˆœì—´ì˜ ê²°ê³¼ì—ì„œ ì¤‘ë³µë˜ëŠ” ê²½ìš°ë¥¼ ì œê±°í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì´ **6ê°€ì§€**ê°€ ë‚˜ì˜µë‹ˆë‹¤.
""")
st.code("""
{A, B}, {A, C}, {A, D}
{B, C}, {B, D}
{C, D}
""")
st.success("ê³„ì‚°: **4C2** = (4 Ã— 3) / (2 Ã— 1) = **6**")
st.markdown("---")

# --- 4. ê°œë… í™•ì¸ í€´ì¦ˆ ---
st.header("âœ… ê°œë… í™•ì¸ í€´ì¦ˆ")
st.write("ë‹¤ìŒ ìƒí™©ì€ ìˆœì—´ê³¼ ì¡°í•© ì¤‘ ë¬´ì—‡ì„ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”? ì²´í¬í•´ë³´ì„¸ìš”.")

# í€´ì¦ˆ ë°ì´í„° (ë¬¸ì œ, ìˆœì—´ ì²´í¬ ì—¬ë¶€, ì¡°í•© ì²´í¬ ì—¬ë¶€, í•´ì„¤)
quiz_data = [
    ("10ëª…ì˜ í•™ìƒ ì¤‘ 3ëª…ì„ ë½‘ì•„ ì´ì–´ë‹¬ë¦¬ê¸° ìˆœì„œë¥¼ ì •í•˜ëŠ” ê²½ìš°", False, False, "ì´ì–´ë‹¬ë¦¬ê¸°ëŠ” 1ë²ˆ, 2ë²ˆ, 3ë²ˆ ì£¼ìì˜ ìˆœì„œê°€ ì¤‘ìš”í•˜ë¯€ë¡œ **ìˆœì—´**ì…ë‹ˆë‹¤."),
    ("ì„œë¡œ ë‹¤ë¥¸ 7ì¢…ë¥˜ì˜ ê½ƒ ì¤‘ì—ì„œ 3ì¢…ë¥˜ë¥¼ ë½‘ì•„ ê½ƒë‹¤ë°œì„ ë§Œë“œëŠ” ê²½ìš°", False, False, "ê½ƒë‹¤ë°œì— ë“¤ì–´ê°€ëŠ” ê½ƒì˜ ìˆœì„œëŠ” ì¤‘ìš”í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ **ì¡°í•©**ì…ë‹ˆë‹¤."),
    ("5ê°œì˜ ìˆ«ì ì¹´ë“œ(1,2,3,4,5)ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì„¸ ìë¦¬ ìì—°ìˆ˜ì˜ ê°œìˆ˜", False, False, "123ê³¼ 321ì´ ë‹¤ë¥¸ ìˆ˜ì´ë“¯ì´, ìˆ«ìì˜ ìë¦¬ê°€ ì¤‘ìš”í•˜ë¯€ë¡œ **ìˆœì—´**ì…ë‹ˆë‹¤."),
    ("ì¶•êµ¬íŒ€ ì„ ìˆ˜ 11ëª… ì¤‘ì—ì„œ ê²½ê¸°ì— ë‚˜ê°ˆ 5ëª…ì˜ ì„ ìˆ˜ë¥¼ ì„ ë°œí•˜ëŠ” ê²½ìš°", False, False, "ê²½ê¸°ì— ë‚˜ê°€ëŠ” ì„ ìˆ˜ 5ëª…ì€ ì—­í•  êµ¬ë¶„ì´ ì—†ìœ¼ë¯€ë¡œ(ì¼ë‹¨ ì„ ë°œë§Œ í•˜ëŠ” ê²ƒì´ë¯€ë¡œ) **ì¡°í•©**ì…ë‹ˆë‹¤.")
]

for i, (question, p_check, c_check, answer) in enumerate(quiz_data):
    st.subheader(question)
    cols = st.columns(2)
    p_check = cols[0].checkbox("ìˆœì—´", key=f"p{i}")
    c_check = cols[1].checkbox("ì¡°í•©", key=f"c{i}")

    if p_check or c_check:
        st.info(answer)